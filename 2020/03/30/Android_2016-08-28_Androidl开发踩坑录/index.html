<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Android经验,">










<meta name="description" content="总结目录 视图篇 如何理解非主线程可以更新UI dialogFragment 全屏时左右留空的解决方案 dialogFragment 全屏时状态栏出现黑色布局的解决方案 dialogFragment 全屏时状态栏出现黑色布局的解决方案 recyclerview 调用 notifyItemRemoved 方法移除某个 Item 之后因为引用 position 引起 crash 的原因 recycl">
<meta name="keywords" content="Android经验">
<meta property="og:type" content="article">
<meta property="og:title" content="Android开发踩坑经验贴(持续更新...)">
<meta property="og:url" content="http://yummylau.com/2020/03/30/Android_2016-08-28_Androidl开发踩坑录/index.html">
<meta property="og:site_name" content="YummyLau">
<meta property="og:description" content="总结目录 视图篇 如何理解非主线程可以更新UI dialogFragment 全屏时左右留空的解决方案 dialogFragment 全屏时状态栏出现黑色布局的解决方案 dialogFragment 全屏时状态栏出现黑色布局的解决方案 recyclerview 调用 notifyItemRemoved 方法移除某个 Item 之后因为引用 position 引起 crash 的原因 recycl">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2020-04-05T03:40:49.656Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android开发踩坑经验贴(持续更新...)">
<meta name="twitter:description" content="总结目录 视图篇 如何理解非主线程可以更新UI dialogFragment 全屏时左右留空的解决方案 dialogFragment 全屏时状态栏出现黑色布局的解决方案 dialogFragment 全屏时状态栏出现黑色布局的解决方案 recyclerview 调用 notifyItemRemoved 方法移除某个 Item 之后因为引用 position 引起 crash 的原因 recycl">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yummylau.com/2020/03/30/Android_2016-08-28_Androidl开发踩坑录/">





  <title>Android开发踩坑经验贴(持续更新...) | YummyLau</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">YummyLau</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Keep moving！</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yummylau.com/2020/03/30/Android_2016-08-28_Androidl开发踩坑录/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yummyLau">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YummyLau">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Android开发踩坑经验贴(持续更新...)</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-30T00:00:00+08:00">
                2020-03-30
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/03/30/Android_2016-08-28_Androidl开发踩坑录/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/03/30/Android_2016-08-28_Androidl开发踩坑录/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <a id="more"></a>
<h3 id="总结目录"><a href="#总结目录" class="headerlink" title="总结目录"></a>总结目录</h3><ul>
<li><a href="#1">视图篇</a><ul>
<li><a href="#1-1">如何理解非主线程可以更新UI</a></li>
<li><a href="#1-2">dialogFragment 全屏时左右留空的解决方案</a></li>
<li><a href="#1-3">dialogFragment 全屏时状态栏出现黑色布局的解决方案</a></li>
<li><a href="#1-3">dialogFragment 全屏时状态栏出现黑色布局的解决方案</a></li>
<li><a href="#1-4">recyclerview 调用 notifyItemRemoved 方法移除某个 Item 之后因为引用 position 引起 crash 的原因</a></li>
<li><a href="#1-5">recyclerview 局部刷新Item时会因为默认动画导致闪烁的解决方案</a></li>
<li><a href="#1-6">recyclerview 中的 item 出现莫名的偏移滚动</a></li>
<li><a href="#1-7">recyclerview 内容超过一屏时，findFistCompletelyVisibleItemPosition 会返回 -1 的原因</a></li>
<li><a href="#1-8">textview 中富文本点击事件拦截了长按事件的解决方案</a></li>
<li><a href="#1-9">如何禁止 ViewPager 的滑动</a></li>
<li><a href="#1-10">如何仿蘑菇街/马蜂窝 Viewpager 装载图片之后切换时动态变更高度</a></li>
<li><a href="#1-11">如何控制 appbarLayout 随时定位到某个位置</a></li>
<li><a href="#1-12">如何禁止 appbarLayout 滚动</a></li>
<li><a href="#1-13">edittext 未能响应 onClickListener 事件的解决方案</a></li>
<li><a href="#1-14">使用 listview 或gridview 的处理 item 的 state_selected 事件是无效的解决方案</a></li>
<li><a href="#1-15">解决5.0以上Button自带阴影效果的方案</a></li>
<li><a href="#1-16">针对 onSingleTapUp 和 onSIngleTapConfirmed 的使用区别</a></li>
<li><a href="#1-17">如何使用layer-list画三角形</a></li>
<li><a href="#1-18">关于属性动画中旋转 View 时部分机型出现 View 闪烁的解决方案</a></li>
<li><a href="#1-19">关于 ConstraintLayout 的代码布局下的注意事项</a></li>
<li><a href="#1-20">TextView 在 6.0 版本下设置单行尾部缩略的坑</a></li>
</ul>
</li>
<li><a href="#2">服务篇</a><ul>
<li><a href="#2-1">后台手动清理应用之后，service中启动的notifications并没有消失的解决方案</a></li>
</ul>
</li>
<li><a href="#3">线程篇</a><ul>
<li><a href="#3-1">建议新起线程不要随便调用网络请求，一般的newThread没有looper队列，参考handlerThread</a></li>
</ul>
</li>
<li><a href="#4">网络篇</a><ul>
<li><a href="#4-1">Retorfit get 请求参数出现错误的解决方案</a></li>
</ul>
</li>
<li><a href="#5">数据篇</a><ul>
<li><a href="#5-1">如何优雅处理 sqlite 多线程读写问题</a></li>
<li><a href="#5-2">如何理解 Intent 传递数据出现 TransactionTooLargeException 的问题</a></li>
</ul>
</li>
<li><a href="#6">机型系统适配篇</a><ul>
<li><a href="#6-1">如何解决 NatigationBar 被 PopupWindow 遮挡的问题</a></li>
<li><a href="#6-2">如何解决MIUI系统后台无法 toast 的问题</a></li>
<li><a href="#6-3">如何解决关闭通知栏权限无法弹出 toast 的问题</a></li>
<li><a href="#6-4">如何适配 vivo 等双面屏幕</a></li>
<li><a href="#6-5">如何解决华为设备产生太多 broadcast 导致crash的问题</a>      <ul>
<li><a href="#6-6">各种通知栏的适配方案</a></li>
</ul>
</li>
<li><a href="#6-7">解决针对魅族推送内容限制的问题</a></li>
<li><a href="#6-8">解决从系统安装起安装应用后启动，Home 隐藏后 Launcher 重复启动的问题</a><ul>
<li><a href="#6-9">针对有launcher做为Activity的应用，在完全没有启动下收到第三方推送（小米，华为，魅族）/分享拉起的注意事项</a></li>
<li><a href="#6-10">针对 App 多场景拉起场景下的场景判断分析</a></li>
</ul>
</li>
<li><a href="#6-11">9.0 android 支持明文连接（Http</a></li>
</ul>
</li>
<li><a href="#7">编译构建篇</a><ul>
<li><a href="#7-1">travis-ci 高版本androidO编译遇到 license 没通过编译失败的解决方案</a></li>
<li><a href="#7-2">Dalvik 支持的 android 版本下进行分包执行会有一些限制</a></li>
<li><a href="#7-3">Dalvik 分包构建每一个 dex 文件时可能出现 java.lang.NoClassDefFoundError</a></li>
<li><a href="#7-4">Java 8 methods of java.lang.Long and java.lang.Character are not desugared by D8</a></li>
<li><a href="#7-5">databinding 中 findBinding vs getBinding 的场景区别</a></li>
<li><a href="#7-6">版本构建出现 Gradle sync failed: Cannot choose between the following configurations of project</a></li>
<li><a href="#7-7">gradle 配置本地离线包</a></li>
<li><a href="#7-8">解决kvm/jvm 编译时 -classpath 遇到的分割及空格的问题</a></li>
<li><a href="#7-9">databinding NoSuchMethodError with buildTool 3.4.0</a></li>
</ul>
</li>
<li><a href="#8">版本控制篇</a><ul>
<li><a href="#8-1">git 修改 commit 记录</a></li>
<li><a href="#8-2">解决git ignore 文件不生效的问题</a></li>
</ul>
</li>
<li><a href="#9">其他</a><ul>
<li><a href="#9-1">ExoPlayer在接听电话之后会导致原来设置的 Source 中静音状态消失了导致可能返回 app 续播的时候视频突然有声音</a></li>
<li><a href="#9-2">AndroidStudio 提示 Please select Android SDK</a></li>
<li><a href="#9-3">关于 Java 中字符与字节的编码关系认识</a></li>
<li><a href="#9-4">关于 emoji 编码的长度计算问题</a></li>
</ul>
</li>
</ul>
<h3 id="1">&lt;&lt;视图篇&gt;&gt;</h3>

<ul>
<li><p></p><h4 id="1-1"> 如何理解非主线程可以更新UI</h4><br>  谷歌在 viewRootImpl 中检查更新ui的线程<p></p>
  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">checkThread</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">if</span> (mThread != Thread.currentThread()) &#123;  </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> CalledFromWrongThreadException(  </span><br><span class="line">                <span class="string">"Only the original thread that created a view hierarchy can touch its views."</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  在执行onCreate的时候这个判断并没有执行到</p>
</li>
<li><h4 id="1-2"> dialogFragment 全屏时左右留空的解决方案</h4>

<p>  在 fragment#onResume 中重新调整 window 布局</p>
  <figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">android.view.WindowManager.LayoutParams </span>lp = window.getAttributes()<span class="comment">;</span></span><br><span class="line">lp.width = WindowManager.LayoutParams.MATCH_PARENT<span class="comment">;</span></span><br><span class="line">lp.height = WindowManager.LayoutParams.WRAP_CONTENT<span class="comment">;</span></span><br><span class="line">window.setAttributes(lp)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p></p><h4 id="1-3"> dialogFragment 全屏时状态栏出现黑色布局的解决方案</h4><br>  在主题中设置<p></p>
  <figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">item</span> <span class="built_in">name</span>=<span class="string">"android:windowIsFloating"</span>&gt;<span class="literal">true</span>&lt;/<span class="built_in">item</span>&gt;</span><br></pre></td></tr></table></figure>
<p>  此时 window 为 wrap_content，如果出现左右空白，则考虑使用上个问题的方案。</p>
</li>
<li><p></p><h4 id="1-4"> recyclerview 调用 notifyItemRemoved 方法移除某个 Item 之后因为引用 position 引起 crash 的原因</h4><br>  <code>notifyItemRemoved</code>方法并不会移除列表的数据源的数据项导致数据源中的数据与列表Item数目不一致，需要同步刷新数据源。<p></p>
</li>
<li><h4 id="1-5"> recyclerview 局部刷新Item时会因为默认动画导致闪烁的解决方案</h4>

<p>  因为<code>recyclerview</code>存在ItemAnimator，且在删除/更新/插入Item时会触发，可设置不支持该动画即可。</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((<span class="selector-tag">SimpleItemAnimator</span>)<span class="selector-tag">recyclerView</span><span class="selector-class">.getItemAnimator</span>())<span class="selector-class">.setSupportsChangeAnimations</span>(<span class="selector-tag">false</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><h4 id="1-6"> recyclerview 中的 item 出现莫名的偏移滚动</h4>

<p>  这个问题经过定位存在于 viewholder 中的某个 view 可能提前获取到焦点。 同时在。alibaba-vlayout 库中也发现有人反馈改问题。 <a href="https://github.com/alibaba/vlayout/issues/225" target="_blank" rel="noopener">issues-255</a>  解决的方法是在 Recyclerview中外层父布局中添加 <code>android:descendantFocusability=&quot;blocksDescendants&quot;</code> 用于父布局覆盖 Recyclerview 优先抢占焦点。</p>
</li>
<li><h4 id="1-7"> recyclerview 内容超过一屏时，findFistCompletelyVisibleItemPosition 会返回 -1 的原因</h4>

<p>  原因是在 <code>findOneVisibleChild</code> 计算出来的 start 和 end 已经超过了 reclclerview 的 start 和 end.经过研究源码得到以下。</p>
  <figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">findFirstCompletelyVisibleItemPosition</span> -&gt;</span> -<span class="number">1</span></span><br><span class="line"><span class="function"><span class="title">findLastCompletelyVisibleItemPosition</span> -&gt;</span> -<span class="number">1</span></span><br><span class="line"><span class="function"><span class="title">findFirstVisibleItemPosition</span> -&gt;</span> 正常</span><br><span class="line">findLast</span><br></pre></td></tr></table></figure>
</li>
<li><p></p><h4 id="1-8"> textview 中富文本点击事件拦截了长按事件的解决方案</h4><br>  这个问题常见于消息列表中，某条消息使用了ClickableSpan用于处理富媒体的点击事件，同时这个消息又需要支持长按复制。由于LinkMovementMethod方法在onTouchEvent一直返回true，可以通过自定义View.onTouchListener来替换setMovenmentMethod达到效果。<p></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClickMovementMethod</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnTouchListener</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> LongClickCallback longClickCallback;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ClickMovementMethod <span class="title">newInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ClickMovementMethod();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(<span class="keyword">final</span> View v, MotionEvent event)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (longClickCallback == <span class="keyword">null</span>) &#123;</span><br><span class="line">        longClickCallback = <span class="keyword">new</span> LongClickCallback(v);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    TextView widget = (TextView) v;</span><br><span class="line">    <span class="comment">// MovementMethod设为空，防止消费长按事件</span></span><br><span class="line">    widget.setMovementMethod(<span class="keyword">null</span>);</span><br><span class="line">    CharSequence text = widget.getText();</span><br><span class="line">    Spannable spannable = Spannable.Factory.getInstance().newSpannable(text);</span><br><span class="line">    <span class="keyword">int</span> action = event.getAction();</span><br><span class="line">    <span class="keyword">if</span> (action == MotionEvent.ACTION_DOWN || action == MotionEvent.ACTION_UP) &#123;</span><br><span class="line">        <span class="keyword">int</span> x = (<span class="keyword">int</span>) event.getX();</span><br><span class="line">        <span class="keyword">int</span> y = (<span class="keyword">int</span>) event.getY();</span><br><span class="line">        x -= widget.getTotalPaddingLeft();</span><br><span class="line">        y -= widget.getTotalPaddingTop();</span><br><span class="line">        x += widget.getScrollX();</span><br><span class="line">        y += widget.getScrollY();</span><br><span class="line">        Layout layout = widget.getLayout();</span><br><span class="line">        <span class="keyword">int</span> line = layout.getLineForVertical(y);</span><br><span class="line">        <span class="keyword">int</span> off = layout.getOffsetForHorizontal(line, x);</span><br><span class="line">        ClickableSpan[] link = spannable.getSpans(off, off, ClickableSpan.class);</span><br><span class="line">        <span class="keyword">if</span> (link.length != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (action == MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">                v.postDelayed(longClickCallback, ViewConfiguration.getLongPressTimeout());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                v.removeCallbacks(longClickCallback);</span><br><span class="line">                link[<span class="number">0</span>].onClick(widget);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (action == MotionEvent.ACTION_CANCEL) &#123;</span><br><span class="line">        v.removeCallbacks(longClickCallback);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">LongClickCallback</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> View view;</span><br><span class="line"></span><br><span class="line">    LongClickCallback(View view) &#123;</span><br><span class="line">        <span class="keyword">this</span>.view = view;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 找到能够消费长按事件的View</span></span><br><span class="line">        View v = view;</span><br><span class="line">        <span class="keyword">boolean</span> consumed = v.performLongClick();</span><br><span class="line">        <span class="keyword">while</span> (!consumed) &#123;</span><br><span class="line">            v = (View) v.getParent();</span><br><span class="line">            <span class="keyword">if</span> (v == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            consumed = v.performLongClick();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">textView.setOnTouchListener(ClickMovementMethod.newInstance());</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><h4 id="1-9"> 如何禁止 ViewPager 的滑动</h4>

<p>  重写ViewPager onTouchEvent 和 onInterceptTouchEvent 并返回false,不处理任何滑动事件</p>
  <figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent arg0)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(MotionEvent arg0)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><h4 id="1-10"> 如何仿蘑菇街/马蜂窝 Viewpager 装载图片之后切换时动态变更高度</h4>

<p>  imageViewPager 为普通的 Viewpager 对象</p>
<p>  imageListInfo为存放图片信息的list，imageShowHeight为业务需要显示高度，通过切换时动态计算调整</p>
  <figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">imageViewPager.getViewTreeObserver().addOnGlobalLayoutListener(<span class="keyword">new</span> ViewTreeObserver.OnGlobalLayoutListener() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> onGlobalLayout() &#123;</span><br><span class="line">        imageViewPager.getViewTreeObserver().removeOnGlobalLayoutListener(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">//根据viewpager的高度，拉伸显示图片的宽度调整高度。</span></span><br><span class="line">        ViewGroup.LayoutParams layoutParams = imageViewPager.getLayoutParams();</span><br><span class="line">        layoutParams.<span class="built_in">height</span> = imageListInfo.imageShowHeight[<span class="number">0</span>];</span><br><span class="line">        imageViewPager.setLayoutParams(layoutParams);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">imageViewPager.setAdapter(imagePagerAdapter);</span><br><span class="line">imageViewPager.addOnPageChangeListener(<span class="keyword">new</span> ViewPager.OnPageChangeListener() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> onPageScrolled(<span class="keyword">int</span> <span class="built_in">position</span>, <span class="keyword">float</span> positionOffset, <span class="keyword">int</span> positionOffsetPixels) &#123;</span><br><span class="line">        <span class="built_in">if</span> (<span class="built_in">position</span> == imageListInfo.getImageListSize() - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> <span class="built_in">height</span> = (<span class="keyword">int</span>) (imageListInfo.imageShowHeight[<span class="built_in">position</span>] * (<span class="number">1</span> - positionOffset) + imageListInfo.imageShowHeight[<span class="built_in">position</span> + <span class="number">1</span>] * positionOffset);</span><br><span class="line">        ViewGroup.LayoutParams params = imageViewPager.getLayoutParams();</span><br><span class="line">        params.<span class="built_in">height</span> = <span class="built_in">height</span>;</span><br><span class="line">        imageViewPager.setLayoutParams(params);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    @Override</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> onPageSelected(<span class="keyword">int</span> <span class="built_in">position</span>) &#123;</span><br><span class="line">        <span class="built_in">if</span> (!clickListBySelf) &#123;</span><br><span class="line">            toSelectIndex(imageListInfo.selected, <span class="built_in">position</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    @Override</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> onPageScrollStateChanged(<span class="keyword">int</span> state) &#123;</span><br><span class="line">	</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p></p><h4 id="1-11"> 如何控制 appbarLayout 随时定位到某个位置</h4><p></p>
  <figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CoordinatorLayout.<span class="keyword">Behavior </span><span class="keyword">behavior </span>=((CoordinatorLayout.LayoutParams)mAppBarLayout.getLayoutParams()).getBehavior()<span class="comment">;</span></span><br><span class="line">if (<span class="keyword">behavior </span><span class="keyword">instanceof </span>AppBarLayout.<span class="keyword">Behavior) </span>&#123;</span><br><span class="line">      AppBarLayout.<span class="keyword">Behavior </span>appBarLayoutBehavior = (AppBarLayout.<span class="keyword">Behavior) </span><span class="keyword">behavior;</span></span><br><span class="line"><span class="keyword"> </span>     int topAndBottomOffset = appBarLayoutBehavior.getTopAndBottomOffset()<span class="comment">;</span></span><br><span class="line">      if (topAndBottomOffset != <span class="number">0</span>) &#123;</span><br><span class="line">             appBarLayoutBehavior.setTopAndBottomOffset(<span class="number">0</span>)<span class="comment">;</span></span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><h4 id="1-12"> 如何禁止 appbarLayout 滚动</h4>

  <figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CoordinatorLayout.LayoutParams params = (CoordinatorLayout.LayoutParams) appBarLayout.getLayoutParams()<span class="comment">;</span></span><br><span class="line">AppBarLayout.<span class="keyword">Behavior </span><span class="keyword">behavior </span>= (AppBarLayout.<span class="keyword">Behavior) </span>params.getBehavior()<span class="comment">;</span></span><br><span class="line"><span class="keyword">behavior.setDragCallback(new </span>AppBarLayout.<span class="keyword">Behavior.DragCallback() </span>&#123;</span><br><span class="line">    @Override</span><br><span class="line">    public <span class="keyword">boolean </span>canDrag(@NonNull AppBarLayout appBarLayout) &#123;</span><br><span class="line">        return false<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><h4 id="1-13"> edittext 未能响应 onClickListener 事件的解决方案</h4>

<p>  <code>Edittext</code>监听未获取焦点的Edittext的点击事件，第一次点击触发OnFocusChangeListener，在获取焦点的情况下才能响应onClickListener</p>
</li>
<li><h4 id="1-14"> 使用 listview 或gridview 的处理 item 的 state_selected 事件是无效的解决方案</h4>

<p>  在xml布局中对listview或gridview设置<strong>Android:choiceMode=”singleChoice”</strong>,并使用state_activated状态来代替state_selected状态。（2016.12.10）</p>
</li>
<li><h4 id="1-15"> 解决5.0以上Button自带阴影效果的方案</h4>

<p>  在xml定义的Button中，添加以下样式定义</p>
  <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">style</span>=<span class="string">"?android:attr/borderlessButtonStyle"</span></span><br></pre></td></tr></table></figure>
</li>
<li><h4 id="1-16"> 针对 onSingleTapUp 和 onSIngleTapConfirmed 的使用区别</h4>

<p>  前者在按下并抬起时发生，后者有一个附加条件时Android会确保点击之后在短时间内没有再次点击才会触发。常用于如果需要监听单击和双击事件。</p>
</li>
<li><h4 id="1-17"> 如何使用layer-list画三角形</h4>

  <figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">	&lt;layer-list xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span> &gt;</span><br><span class="line">	<span class="comment">//左</span></span><br><span class="line">    &lt;item&gt;</span><br><span class="line">        &lt;<span class="built_in">rotate</span></span><br><span class="line">            android:fromDegrees=<span class="string">"45"</span></span><br><span class="line">            android:pivotX=<span class="string">"85%"</span></span><br><span class="line">            android:pivotY=<span class="string">"135%"</span>&gt;</span><br><span class="line">            &lt;<span class="built_in">shape</span> android:<span class="built_in">shape</span>=<span class="string">"rectangle"</span>&gt;</span><br><span class="line">                &lt;<span class="built_in">size</span></span><br><span class="line">                    android:<span class="built_in">width</span>=<span class="string">"16dp"</span></span><br><span class="line">                    android:<span class="built_in">height</span>=<span class="string">"16dp"</span> /&gt;</span><br><span class="line">                &lt;solid android:<span class="built_in">color</span>=<span class="string">"#7d72ff"</span> /&gt;</span><br><span class="line">            &lt;/<span class="built_in">shape</span>&gt;</span><br><span class="line">        &lt;/<span class="built_in">rotate</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/item&gt;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//右</span></span><br><span class="line">    &lt;item&gt;</span><br><span class="line">        &lt;<span class="built_in">rotate</span></span><br><span class="line">            android:fromDegrees=<span class="string">"45"</span></span><br><span class="line">            android:pivotX=<span class="string">"15%"</span></span><br><span class="line">            android:pivotY=<span class="string">"-35%"</span>&gt;</span><br><span class="line">            &lt;<span class="built_in">shape</span> android:<span class="built_in">shape</span>=<span class="string">"rectangle"</span>&gt;</span><br><span class="line">                &lt;<span class="built_in">size</span></span><br><span class="line">                    android:<span class="built_in">width</span>=<span class="string">"16dp"</span></span><br><span class="line">                    android:<span class="built_in">height</span>=<span class="string">"16dp"</span> /&gt;</span><br><span class="line">                &lt;solid android:<span class="built_in">color</span>=<span class="string">"#7d72ff"</span> /&gt;</span><br><span class="line">            &lt;/<span class="built_in">shape</span>&gt;</span><br><span class="line">        &lt;/<span class="built_in">rotate</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/item&gt;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//上/正</span></span><br><span class="line">    &lt;item&gt;</span><br><span class="line">        &lt;<span class="built_in">rotate</span></span><br><span class="line">            android:fromDegrees=<span class="string">"45"</span></span><br><span class="line">            android:pivotX=<span class="string">"-40%"</span></span><br><span class="line">            android:pivotY=<span class="string">"80%"</span>&gt;</span><br><span class="line">            &lt;<span class="built_in">shape</span> android:<span class="built_in">shape</span>=<span class="string">"rectangle"</span>&gt;</span><br><span class="line">                &lt;<span class="built_in">size</span></span><br><span class="line">                    android:<span class="built_in">width</span>=<span class="string">"16dp"</span></span><br><span class="line">                    android:<span class="built_in">height</span>=<span class="string">"16dp"</span>/&gt;</span><br><span class="line">                &lt;solid android:<span class="built_in">color</span>=<span class="string">"#7d72ff"</span>/&gt;</span><br><span class="line">            &lt;/<span class="built_in">shape</span>&gt;</span><br><span class="line">        &lt;/<span class="built_in">rotate</span>&gt;</span><br><span class="line">    &lt;/item&gt;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//下</span></span><br><span class="line">    &lt;item&gt;</span><br><span class="line">        &lt;<span class="built_in">rotate</span></span><br><span class="line">            android:fromDegrees=<span class="string">"45"</span></span><br><span class="line">            android:pivotX=<span class="string">"135%"</span></span><br><span class="line">            android:pivotY=<span class="string">"15%"</span>&gt;</span><br><span class="line">            &lt;<span class="built_in">shape</span> android:<span class="built_in">shape</span>=<span class="string">"rectangle"</span>&gt;</span><br><span class="line">                &lt;<span class="built_in">size</span></span><br><span class="line">                    android:<span class="built_in">width</span>=<span class="string">"16dp"</span></span><br><span class="line">                    android:<span class="built_in">height</span>=<span class="string">"16dp"</span>/&gt;</span><br><span class="line">                &lt;solid android:<span class="built_in">color</span>=<span class="string">"#7d72ff"</span>/&gt;</span><br><span class="line">            &lt;/<span class="built_in">shape</span>&gt;</span><br><span class="line">        &lt;/<span class="built_in">rotate</span>&gt;</span><br><span class="line">    &lt;/item&gt;</span><br><span class="line">&lt;/layer-list&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p></p><h4 id="1-18"> 关于属性动画中旋转 View 时部分机型出现 View 闪烁的解决方案 </h4><br>  在大神 app 信息流快捷评论模块中，在交付快捷评论动画的时候发现，使用属性动画实现的抖动效果在部分机型上出现闪烁。而我们的实现抖动效果是通过 <code>View.ROTATION</code> 来实现的。经过研究，部分机型因为硬件加速的原因导致的。为动画 view 进行以下设置<p></p>
  <figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">view</span>.setLayerType(<span class="built_in">View</span>.LAYER_TYPE_HARDWARE,<span class="built_in">null</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p></p><h4 id="1-19"> 关于 ConstraintLayout 的代码布局下的注意事项 </h4><br>  不同于其他 ViewGroup 控制子 View 的排版，ConstraintLayout 需要构建 <code>ConstraintSet</code> 对象来粘合。 在手动添加子 View 的场景下，可以通过 <code>ConstraintSet#clone(ConstraintLayout constraintLayout)</code> 来克隆当前已有 ConstraintLayout 的排版信息，然后最后调用 <code>ConstraintSet#applyTo(ConstraintLayout constraintLayout)</code> 确认最终的排版信息。<p></p>
</li>
<li><p></p><h4 id="1-20"> TextView 在 6.0 版本下设置单行尾部缩略的坑 </h4><br>  在大神信息流中，有一些卡片信息需要设置单行缩略。在 MTL 兼容测试过程中发现有一些机型显示异常，经过归纳及校验，这部分机型的版本都是 &lt; 6.0。 通过在 stackoverflow 也找到了相同的问题场景 <a href="https://stackoverflow.com/questions/42524277/text-ellipsize-behavior-in-android-version-6-0" target="_blank" rel="noopener">text ellipsize behavior in android version &lt; 6.0</a> . 针对这部分版本的手机，我们需要在设置单行的时候把 <code>android:maxLines=&quot;1&quot;</code> 改成 <code>android:singleLine=&quot;true&quot;</code>。即使 IDE 提示该 API 已经过期了！<p></p>
</li>
</ul>
<h3 id="2">&lt;&lt;服务篇&gt;&gt;</h3>

<ul>
<li><h4 id="2-1"> 后台手动清理应用之后，service中启动的notifications并没有消失的解决方案</h4>

<p>  从 <a href="https://stackoverflow.com/questions/22210241/how-to-remove-all-notifications-when-an-android-app-activity-or-service-is-kil" target="_blank" rel="noopener">How to remove all notifications when an android app (activity or service) is killed?</a> 的诸多讨论中学习到， <code>Service#onTaskRemoved</code> 是我们的App被清理之后Service的回调。尝试过一下方法并不能达到清除的效果。</p>
  <figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onTaskRemoved</span><span class="params">(Intent rootIntent)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onTaskRemoved(rootIntent);</span><br><span class="line">    NotificationManager nManager = ((NotificationManager) getSystemService(Context.NOTIFICATION_SERVICE));</span><br><span class="line">    nManager.cancelAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  在线上应用中，由于我们的通知类似于将军令这种有定时更新的功能，需要彻底干掉所有serivce承载的功能，下面方法可行</p>
  <figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onTaskRemoved</span><span class="params">(Intent rootIntent)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">super</span>.onTaskRemoved(rootIntent);</span><br><span class="line">      stopSelf();</span><br><span class="line">      stopForeground(<span class="keyword">true</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="3">&lt;&lt;线程篇&gt;&gt;</h3>

<ul>
<li><h4 id="3-1"> 建议新起线程不要随便调用网络请求，一般的newThread没有looper队列，参考handlerThread</h4>

</li>
</ul>
<h3 id="4">&lt;&lt;网络篇&gt;&gt;</h3>

<ul>
<li><h4 id="4-1"> Retorfit get 请求参数出现错误的解决方案</h4>

  <figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GET</span>( BASE_URL + <span class="string">"index/login"</span> )</span><br><span class="line">Observable&lt; LoginResult &gt; requestLogin( <span class="meta">@QueryMap</span>(encoded = <span class="keyword">true</span>) <span class="built_in">Map</span>&lt; <span class="built_in">String</span>, <span class="built_in">String</span> &gt; params );</span><br><span class="line"> </span><br><span class="line"><span class="keyword">final</span> <span class="built_in">Map</span>&lt; <span class="built_in">String</span>, <span class="built_in">String</span> &gt; paramsMap = <span class="keyword">new</span> ParamsProvider.Builder().</span><br><span class="line">        append( <span class="string">"username"</span>, account ).</span><br><span class="line">        append( <span class="string">"password"</span>,URLEncoded(password) ).</span><br></pre></td></tr></table></figure>
<p>  比如登陆，encode = true 表示未对特殊字符进行url编码，默认是false。</p>
</li>
</ul>
<h3 id="5">&lt;&lt;数据篇&gt;&gt;</h3>

<ul>
<li><h4 id="5-1"> 如何优雅处理 sqlite 多线程读写问题</h4>

<ul>
<li>一个helper实例对应一个 db connectton，这个连接能提供读连接和写连接，如果只是调用 read-only，则默认也会有写连接。</li>
<li>一个helper实例可以在多个线程中使用，java层会使用锁机制保证线程同步，哪怕有100个线程，对数据度的调用也会被序列化</li>
<li><p>如果尝试从不同 connection 同时对数据库进行写操作，则有一个会失败。并不会按照第一个写完再轮到第二个写，有一些sqlite版本甚至不会有错误提示。</p>
<p>一般而言，如果要在多线程环境下使用数据库，则确保多个线程中使用的是同一个SQLiteDataBase对象，该对象对应一个db文件。</p>
<p>特殊情况，如果多个 SQLiteDataBase 打开同一个 db 文件，同时使用不同线程同时写（insert，update，exexSQL）会导致在 <code>SQLiteStatement.native_execute</code> 方法时可能导致异常。这个异常来自本地方法里面，仅仅在Java对有对 SQLiteDataBase 进行同步锁保护。但是多线程读（query）返回的事 SQLiteCursor保存查询条件并没有立刻执行查询，仅仅在需要时加载部分数据，可以多线程不同 SQLiteDataBase 进行读。</p>
<p>如果要处理上述问题，可以使用 “<em>一个线程写，多个线程同时读，每个线程都用各自SQLiteOpenHelper</em>。”</p>
<p>在android 3.0版本以上 打开 enableWriteAheadLogging。当打开时，它允许一个写线程与多个读线程同时在一个SQLiteDatabase上起作用。实现原理是写操作其实是在一个单独的文件，不是原数据库文件。所以写在执行时，不会影响读操作，读操作读的是原数据文件，是写操作开始之前的内容。在写操作执行成功后，会把修改合并会原数据库文件。此时读操作才能读到修改后的内容。但是这样将花费更多的内存。</p>
</li>
</ul>
</li>
<li><h4 id="5-1"> 如何理解 Intent 传递数据出现 <code>TransactionTooLargeException</code>的问题</h4>

<p>Intent 传输数据的机制中，用到了 Binder。Intent 中的数据，会作为 Parcel 被存储在 Binder 的事务缓冲区(Binder transaction buffer)中的对象进行传输.而这个 Binder 事务缓冲区具有一个有限的固定大小，当前为 1MB。你可别以为传递 1MB 以下的数据就安全了，这里的 1MB 空间并不是当前操作独享的，而是由当前进程所共享。也就是说 Intent 在 Activity 间传输数据，本身也不适合传递太大的数据.</p>
<p>参考阿里 《Android 开发者手册》 对于Activity间数据通讯数据较大，避免使用Intent+Parcelable的方式，可以考虑使用EventBus等代替方案，避免 <code>TransactionTooLargeException</code>。EventBus使用黏性事件来解决，但是针对Activity重建又能拿到Intent而EventBus则不可以，所以需要根据业务来调整。</p>
</li>
</ul>
<h3 id="6">&lt;&lt;机型系统适配篇&gt;&gt;</h3>

<ul>
<li><h4 id="6-1"> 如何解决 NatigationBar 被 PopupWindow 遮挡的问题</h4>

  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">popupWindow</span><span class="selector-class">.setSoftInputMode</span>(<span class="selector-tag">WindowManager</span><span class="selector-class">.LayoutParams</span><span class="selector-class">.SOFT_INPUT_ADJUST_RESIZE</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><h4 id="6-2"> 如何解决MIUI系统后台无法 toast 的问题</h4>

<p>  参考 <a href="https://github.com/zhitaocai/ToastCompat_Deprecated" target="_blank" rel="noopener">https://github.com/zhitaocai/ToastCompat_Deprecated</a> 项目，但是在小米3或者小米Note（4.4.4）手机上</p>
  <figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mWindowManager</span> = (WindowManager) mContext.getSystemService(Context.WINDOW_SERVICE)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>  mContext 需要使用 ApplicationContext 才能生效。</p>
</li>
<li><h4 id="6-3"> 如何解决关闭通知栏权限无法弹出 toast 的问题</h4>

<p>  由于谷歌把 Toast 设置为系统消息权限，可以参考 <a href="http://w4lle.com/2016/03/27/Android%E5%85%B3%E9%97%AD%E9%80%9A%E7%9F%A5%E6%B6%88%E6%81%AF%E6%9D%83%E9%99%90%E6%97%A0%E6%B3%95%E5%BC%B9%E5%87%BAToast%E7%9A%84%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" target="_blank" rel="noopener">Android关闭通知消息权限无法弹出Toast的解决方案</a> 维护自己的消息队列.</p>
</li>
<li><h4 id="6-4"> 如何适配 vivo 等双面屏幕</h4>

<p>  在 AndroidManifest.xml 中声明一下 meta-data</p>
  <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta-data</span><br><span class="line">android:<span class="attribute">name</span>=<span class="string">"andriod.max_aspect"</span> android:<span class="attribute">value</span>=<span class="string">"ratio_float"</span>/&gt;</span><br></pre></td></tr></table></figure>
<p>  或者使用 <code>android:maxAspectRatio=&quot;ratio_float&quot;(API LEVEL 26)</code><br>  ratio_float 一般为屏幕分辨率高宽比。<br>  其他比如凹槽区域，圆角切割等问题可以参考市面上最新的vivo机型对应的 <a href="https://www.jianshu.com/p/4ed3b38d888d" target="_blank" rel="noopener">vivo开放平台</a> 文档。</p>
</li>
<li><h4 id="6-5"> 如何解决华为设备产生太多 broadcast 导致crash的问题</h4>

<p>  由于部分华为中，如果app注册超过500个BroadcastReceiver就会抛出 “ <em>Register too many Broadcast Receivers</em> ” 异常。通过分析发现其内部有一个白名单，自己可以通过创建一个新的app，使用微信包名进行测试，发现并没有这个限制。通过反射 LoadedApk 类拿到 mReceiverResource 中的 mWhiteList 对象添加我们的包名就可以了。 可以参考 <a href="https://github.com/llew2011/HuaWeiVerifier" target="_blank" rel="noopener">https://github.com/llew2011/HuaWeiVerifier</a> 这个项目。</p>
</li>
<li><h4 id="6-6"> 各种通知栏的适配方案</h4>

<p>  参考 <a href="https://iluhcm.com/2017/03/12/experience-of-adapting-to-android-notifications/" target="_blank" rel="noopener">网易考拉实现的适配方法</a></p>
</li>
<li><h4 id="6-7"> 解决针对魅族推送内容限制的问题</h4>

<p>  今天收到魅族渠道的警报称“推送内容可能过长”。IM功能针对离线设备走设备商的推送，魅族推送限制了title标题1-32字符，content内容1-100字符。如果频繁推送超过限制的通知，魅族推送服务器可能不会下发推送到魅族设备。故服务端限制发送到魅族服务器的消息标题和内容长度解决。</p>
</li>
<li><h4 id="6-8"> 解决从系统安装起安装应用后启动，Home 隐藏后 Launcher 重复启动的问题</h4>

<p>  判断启动页面是否是根节点(推荐)</p>
  <figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!isTaskRoot())&#123;</span><br><span class="line">	finish();</span><br><span class="line">	<span class="keyword">return</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  或者判断Activity是否多了 <strong>FLAG_ACTIVITY_BROUGHT_TO_FRONT</strong> ，这个tag是该场景导致的</p>
  <figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((getIntent().getFlags() &amp; <span class="keyword">Intent</span>.FLAG_ACTIVITY_BROUGHT_TO_FRONT) <span class="comment">!= 0) &#123;</span></span><br><span class="line">        finish();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><h4 id="6-9"> 针对有launcher做为Activity的应用，在完全没有启动下收到第三方推送（小米，华为，魅族）/分享拉起的注意事项</h4>

<p>  由于我们的应用LauncherActivity用于分发不同场景的入口，A逻辑进入特殊场景页面A，B逻辑进入主页面B。</p>
<ul>
<li>onCreate中优先拦截 intent 判断拉起参数，如果有拉起参数则直接进入主页面B，intent交付给主页面B处理</li>
<li><p>部分场景下，比如第三方消息推送，华为和小米拉起闪屏或 launcher intent无法区分，针对该做法是，限定进入闪屏/launcher的逻辑,剩余场景统一进入主页面B</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (后端控制是否需要进入特殊场景页面) &#123;</span><br><span class="line">        boolean goToA = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (getIntent() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="built_in">String</span> action = getIntent().getAction();</span><br><span class="line">            <span class="built_in">Set</span>&lt;<span class="built_in">String</span>&gt; category = getIntent().getCategories();</span><br><span class="line">            <span class="keyword">if</span> (TextUtils.equals(action, <span class="string">"android.intent.action.MAIN"</span>)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (category != <span class="keyword">null</span> &amp;&amp; category.contains(<span class="string">"android.intent.category.LAUNCHER"</span>)) &#123;</span><br><span class="line">                    Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, 页面A.<span class="keyword">class</span>);</span><br><span class="line">                    intent.setData(getIntent().getData());</span><br><span class="line">                    startActivity(intent);</span><br><span class="line">                    goToA = <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (! goToA) &#123;</span><br><span class="line">            goToMainActivity();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        goToMainActivity();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><h4 id="6-10"> 针对 App 多场景拉起场景下的场景判断分析</h4>

<p>  可参考我另一篇文章 <a href="http://yummylau.com/2019/06/26/Adnroid_2019-06-06_%E5%AF%B9%E7%BA%BF%E4%B8%8A%E9%A1%B9%E7%9B%AE%E6%8B%89%E8%B5%B7%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E7%9A%84%E6%80%9D%E8%80%83%E6%80%BB%E7%BB%93/">对线上项目拉起应用场景的思考总结</a></p>
</li>
<li><h4 id="6-11"> 9.0 android 支持明文连接（Http）</h4>

<p> Android 9（API级别28）开始，默认情况下禁用明文支持</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">...</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.INTERNET"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span></span></span><br><span class="line"><span class="tag">        <span class="attr">...</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:usesCleartextTraffic</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">...</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="7">&lt;&lt;编译构建篇&gt;&gt;</h3>

<ul>
<li><h4 id="7-1"> travis-ci 高版本androidO编译遇到 license 没通过编译失败的解决方案</h4>

<p>  参考 <a href="https://travis-ci.community/t/unable-to-accept-license-for-build-28-0-3-and-android-sdk-27/2883" target="_blank" rel="noopener">CI 讨论区</a> 添加 <code>dist: precise</code> 及 <code>before_install 项中新增 sdkmanager指令</code>。具体可参考我的 <a href="https://github.com/YummyLau/PanelSwitchHelper/blob/master/.travis.yml" target="_blank" rel="noopener">开源项目配置</a></p>
</li>
</ul>
<ul>
<li><h4 id="7-2"> Dalvik 支持的 android 版本下进行分包执行会有一些限制</h4>

<ul>
<li>冷启动时需要安装dex文件，如果dex文件太大则可能导致处理时间太长导致 ANR</li>
<li>即使使用 multiDex 方案在低于 4.0 系统上可能会出现 Dalvik linearAlloc 的bug，这是因为该方案需要申请一个很大的内存，运行时可能的导致程序崩溃。这个限制在 4.0 上虽然有所改善了，但是还是可能在低于 5.0 的机器上触发。</li>
</ul>
</li>
<li><h4 id="7-3"> Dalvik 分包构建每一个 dex 文件时可能出现 java.lang.NoClassDefFoundError</h4>

<p>  这个问题的原因是构建工具绘制行比较复杂决策来确定主 dex 文件中需要的类以便应用能够正常的启动。如果启动期间需要的任何类在主 dex 中未能找到，则会抛出上述异常。所有必须要 multiDexKeepFile 或 multiDexKeepProguard 属性中声明他们，手动将这些类指定为主 dex 文件中的必需项。</p>
<p>  创建 multidex-new.txt文件，写入以下新增的类</p>
  <figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">com<span class="regexp">/example/</span>Main2.<span class="keyword">class</span></span><br><span class="line">com<span class="regexp">/example/</span>Main3.<span class="keyword">class</span></span><br></pre></td></tr></table></figure>
<p>  创建 meltidex-new.pro,写入以下 keep 住的类</p>
  <figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">keep <span class="class"><span class="keyword">class</span> <span class="title">com</span>.<span class="title">example</span>.<span class="title">Main2</span></span></span></span><br><span class="line"><span class="ruby">-keep <span class="class"><span class="keyword">class</span> <span class="title">com</span>.<span class="title">example</span>.<span class="title">Main3</span></span></span></span><br></pre></td></tr></table></figure>
<p>  然后在gradle multiDexKeepFile属性 和 multiDexKeepProguard属性声明上述文件</p>
  <figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">android</span> &#123;</span><br><span class="line">   <span class="section">buildTypes</span> &#123;</span><br><span class="line">       <span class="section">release</span> &#123;</span><br><span class="line">           <span class="attribute">multiDexKeepFile</span> file <span class="string">'multidex-new.txt'</span></span><br><span class="line">           multiDexKeepProguard <span class="string">'multidex-new.pro'</span></span><br><span class="line">           ...</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><h4 id="7-4"> Java 8 methods of java.lang.Long and java.lang.Character are not desugared by D8 </h4>

<p>  这个问题出现在使用 Kotlin 编译时，从 Kotlin1.3.30 版本开始 ndroid.compileOptions中的Java版本推断出JVM目标，如果同时设置了sourceCompatibility和targetCompatibility，则选择“1.8”到那个或更高. 可以通过指定 JavaVersion 1.6 来解决这个问题。</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">sourceCompatibility</span> <span class="selector-tag">JavaVersion</span><span class="selector-class">.VERSION_1_6</span></span><br><span class="line">   <span class="selector-tag">targetCompatibility</span> <span class="selector-tag">JavaVersion</span><span class="selector-class">.VERSION_1_6</span></span><br></pre></td></tr></table></figure>
<p>   <a href="https://issuetracker.google.com/issues/129730297" target="_blank" rel="noopener">Issue</a> 中表示，AGP（Android Gradle Plugin）3.4 已解决脱糖问题，可尝试升级解决。</p>
</li>
<li><h4 id="7-5"> databinding 中 findBinding vs getBinding 的场景区别 </h4>

<p>  不同之处在于，findBinding将遍历父节点，而如果使用getBinding时当view不是跟节点会返回null。</p>
</li>
<li><h4 id="7-6"> 版本构建出现 Gradle sync failed: Cannot choose between the following configurations of project </h4>

<p>  参考 <a href="https://github.com/dialogflow/dialogflow-android-client/issues/57" target="_blank" rel="noopener">issues</a> 的回答</p>
<p>  If you’re using Android plugin for Gradle 3.0.0 or higher, the plugin automatically matches each variant of your app with corresponding variants of its local library module dependencies for you. That is, you should no longer target specific variants of local module dependencies, show as below</p>
  <figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="selector-tag">dependencies</span> &#123;</span><br><span class="line"> <span class="comment">// Adds the 'debug' varaint of the library to the debug varaint of the app</span></span><br><span class="line"> <span class="selector-tag">debugCompile</span> <span class="selector-tag">project</span>(<span class="attribute">path</span>: <span class="string">':my-library-module'</span>, <span class="attribute">configuration</span>: <span class="string">'debug'</span>)</span><br><span class="line"></span><br><span class="line"> <span class="comment">// Adds the 'release' varaint of the library to the release varaint of the app</span></span><br><span class="line"> <span class="selector-tag">releaseCompile</span> <span class="selector-tag">project</span>(<span class="attribute">path</span>: <span class="string">':my-library-module'</span>, <span class="attribute">configuration</span>: <span class="string">'release'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><h4 id="7-7"> gradle 配置本地离线包</h4>

<ol>
<li>离线下载 gradle 离线包保存在 url 中</li>
<li>修改 <em>gradle/wrapper/gradle-wrapper.properties</em> 调整 <em>distributionUrl</em> 目录指向 url</li>
<li>修改 <em>build.gradle</em>  classpath 版本映射 gradle 版本</li>
</ol>
</li>
<li><h4 id="7-8"> 解决kvm/jvm 编译时 -classpath 遇到的分割及空格的问题</h4>

<p>  linux/mac OS 上使用 “：” 分割多个classpath路径，window使用 “；” 分割。</p>
<p>  如果linux/mac OS 路径存在空格，暂时避免，使用多种方式尝试未果=。=。</p>
</li>
<li><p></p><h4 id="7-9"> databinding NoSuchMethodError with buildTool 3.4.0</h4><br>  项目从 gradle 3.1 升级到 3.4.0 并使用了 androidx 之后，发现编译失败了。来项目就是使用 databinding，编译出现了<p></p>
  <figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">java.lang.NoSuchMethodError: No direct <span class="function"><span class="keyword">method</span> &lt;<span class="title">init</span>&gt;</span></span><br><span class="line"><span class="function"><span class="params">(Landroidx/databinding/DataBindingComponent;Landroid/view/View;I)</span><span class="title">V</span> <span class="title">in</span> </span></span><br><span class="line"><span class="function"><span class="title">class</span> <span class="title">Landroidx</span>/<span class="title">databinding</span>/<span class="title">ViewDataBinding</span>;</span> <span class="keyword">or</span> its super classes</span><br><span class="line">(declaration <span class="keyword">of</span> <span class="string">'androidx.databinding.ViewDataBinding'</span></span><br></pre></td></tr></table></figure>
<p>  原因我们使用的 aar 库中使用了旧版本 gradle 编译，新版本主端 gradle 升级了，导致旧的 ViewDataBinding 构造器签名匹配不上新版 androidx.databinding.ViewDataBinding 的签名。</p>
  <figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//旧版本</span></span><br><span class="line"><span class="keyword">protected</span> ViewDataBinding(DataBindingComponent bindingComponent, View root, <span class="built_in">int</span> localFieldCount)</span><br><span class="line"><span class="comment">//新版本</span></span><br><span class="line"><span class="keyword">protected</span> ViewDataBinding(<span class="keyword">Object</span> bindingComponent, View root, <span class="built_in">int</span> localFieldCount)</span><br></pre></td></tr></table></figure>
<p>  幸运的是，3.4.1已经修复了。更改 3.4.0 -&gt; 3.4.1 就可以了。</p>
</li>
</ul>
<h3 id="8">&lt;&lt;版本控制篇&gt;&gt;</h3>

<ul>
<li><h4 id="8-1"> git 修改 commit 记录</h4>

  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git <span class="keyword">reset</span> <span class="comment">--soft HEAD^</span></span><br><span class="line"></span><br><span class="line">撤销当前的<span class="keyword">commit</span>，如果只是修改提示，则使用</span><br><span class="line">git <span class="keyword">commit</span> <span class="comment">--amend</span></span><br></pre></td></tr></table></figure>
</li>
<li><h4 id="8-2"> 解决git ignore 文件不生效的问题</h4>

  <figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git rm -r --cached .</span><br><span class="line">git <span class="keyword">add</span><span class="bash"> .</span></span><br><span class="line"><span class="bash">git commit -m <span class="string">'update .gitignore'</span></span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="9">&lt;&lt;其他&gt;&gt;</h3>

<ul>
<li><h4 id="9-1"> ExoPlayer在接听电话之后会导致原来设置的 Source 中静音状态消失了导致可能返回 app 续播的时候视频突然有声音</h4>

<p>  原因是多媒体焦点被通话抢夺之后播放音量被充值，解决方法可参考 <a href="https://github.com/google/ExoPlayer/issues/5092" target="_blank" rel="noopener">https://github.com/google/ExoPlayer/issues/5092</a> </p>
</li>
<li><h4 id="9-2"> AndroidStudio 提示 Please select Android SDK</h4>

<p>  解决手段： File-&gt;Project Structure中修改Build tools version</p>
</li>
<li><h4 id="9-3"> 关于 Java 中字符与字节的编码关系认识 </h4>

  <figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">unicode编码下<span class="number">1</span>个中文字符或英文字符都占<span class="number">2</span>个字节；</span><br><span class="line">GBK编码下测试：</span><br><span class="line">“java测试”.length() 返回 <span class="number">6</span>，“GBK测试”.getBytes().length() 返回 <span class="number">8</span></span><br><span class="line">总结：<span class="number">1</span>个中文字符占<span class="number">2</span>个字节  <span class="number">1</span>个英文字符占<span class="number">1</span>个字节</span><br><span class="line">utf<span class="number">-8</span>编码下测试：</span><br><span class="line">“java测试”.length() 返回 <span class="number">6</span>，“GBK测试”.getBytes().length() 返回 <span class="number">10</span></span><br><span class="line">总结：<span class="number">1</span>个中文字符占<span class="number">3</span>个字节  <span class="number">1</span>个英文字符占<span class="number">1</span>个字节</span><br><span class="line">utf<span class="number">-16</span>编码下测试：</span><br><span class="line">“java测试”.length() 返回 <span class="number">6</span>，“GBK测试”.getBytes().length() 返回 <span class="number">14</span></span><br><span class="line">总结：<span class="number">1</span>个中文字符占<span class="number">3</span>个字节  <span class="number">1</span>个英文字符占<span class="number">2</span>个字节</span><br><span class="line">utf<span class="number">-32</span>编码下测试：</span><br><span class="line">“java测试”.length() 返回 <span class="number">6</span>，“GBK测试”.getBytes().length() 返回 <span class="number">24</span></span><br><span class="line">总结：<span class="number">1</span>个中文字符或英文字符都占<span class="number">4</span>个字节</span><br></pre></td></tr></table></figure>
</li>
<li><p></p><h4 id="9-4"> 关于 emoji 编码的长度计算问题 </h4><br>  重点熟悉下 Unicode 编码标识的 emoji 下针对多平面 emoji 的拆分逻辑。<a href="http://objcer.com/2017/07/20/explore-emoji-length/" target="_blank" rel="noopener">可参考这篇文章</a><p></p>
</li>
</ul>

      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    yummyLau
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://yummylau.com/2020/03/30/Android_2016-08-28_Androidl开发踩坑录/" title="Android开发踩坑经验贴(持续更新...)">http://yummylau.com/2020/03/30/Android_2016-08-28_Androidl开发踩坑录/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Android经验/" rel="tag"># Android经验</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/03/22/开源项目_20120-03-22_输入法切换框架(2)/" rel="next" title="开源项目之 PanelSwitchHelper（二）">
                <i class="fa fa-chevron-left"></i> 开源项目之 PanelSwitchHelper（二）
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/03/30/项目总结_2020-03-30_大神androidx迁移记录/" rel="prev" title="大神主端/库 AndroidX 迁移记录">
                大神主端/库 AndroidX 迁移记录 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/uploads/avatar.jpg" alt="yummyLau">
            
              <p class="site-author-name" itemprop="name">yummyLau</p>
              <p class="site-description motion-element" itemprop="description">努力让自己更优秀。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">79</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">18</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">43</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/YummyLau" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-globe"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#总结目录"><span class="nav-number">1.</span> <span class="nav-text">总结目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1"><span class="nav-number">2.</span> <span class="nav-text">&lt;&lt;视图篇&gt;&gt;</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1"><span class="nav-number">2.1.</span> <span class="nav-text"> 如何理解非主线程可以更新UI</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2"><span class="nav-number">2.2.</span> <span class="nav-text"> dialogFragment 全屏时左右留空的解决方案</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3"><span class="nav-number">2.3.</span> <span class="nav-text"> dialogFragment 全屏时状态栏出现黑色布局的解决方案</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4"><span class="nav-number">2.4.</span> <span class="nav-text"> recyclerview 调用 notifyItemRemoved 方法移除某个 Item 之后因为引用 position 引起 crash 的原因</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-5"><span class="nav-number">2.5.</span> <span class="nav-text"> recyclerview 局部刷新Item时会因为默认动画导致闪烁的解决方案</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-6"><span class="nav-number">2.6.</span> <span class="nav-text"> recyclerview 中的 item 出现莫名的偏移滚动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-7"><span class="nav-number">2.7.</span> <span class="nav-text"> recyclerview 内容超过一屏时，findFistCompletelyVisibleItemPosition 会返回 -1 的原因</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-8"><span class="nav-number">2.8.</span> <span class="nav-text"> textview 中富文本点击事件拦截了长按事件的解决方案</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-9"><span class="nav-number">2.9.</span> <span class="nav-text"> 如何禁止 ViewPager 的滑动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-10"><span class="nav-number">2.10.</span> <span class="nav-text"> 如何仿蘑菇街/马蜂窝 Viewpager 装载图片之后切换时动态变更高度</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-11"><span class="nav-number">2.11.</span> <span class="nav-text"> 如何控制 appbarLayout 随时定位到某个位置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-12"><span class="nav-number">2.12.</span> <span class="nav-text"> 如何禁止 appbarLayout 滚动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-13"><span class="nav-number">2.13.</span> <span class="nav-text"> edittext 未能响应 onClickListener 事件的解决方案</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-14"><span class="nav-number">2.14.</span> <span class="nav-text"> 使用 listview 或gridview 的处理 item 的 state_selected 事件是无效的解决方案</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-15"><span class="nav-number">2.15.</span> <span class="nav-text"> 解决5.0以上Button自带阴影效果的方案</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-16"><span class="nav-number">2.16.</span> <span class="nav-text"> 针对 onSingleTapUp 和 onSIngleTapConfirmed 的使用区别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-17"><span class="nav-number">2.17.</span> <span class="nav-text"> 如何使用layer-list画三角形</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-18"><span class="nav-number">2.18.</span> <span class="nav-text"> 关于属性动画中旋转 View 时部分机型出现 View 闪烁的解决方案 </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-19"><span class="nav-number">2.19.</span> <span class="nav-text"> 关于 ConstraintLayout 的代码布局下的注意事项 </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-20"><span class="nav-number">2.20.</span> <span class="nav-text"> TextView 在 6.0 版本下设置单行尾部缩略的坑 </span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2"><span class="nav-number">3.</span> <span class="nav-text">&lt;&lt;服务篇&gt;&gt;</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1"><span class="nav-number">3.1.</span> <span class="nav-text"> 后台手动清理应用之后，service中启动的notifications并没有消失的解决方案</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3"><span class="nav-number">4.</span> <span class="nav-text">&lt;&lt;线程篇&gt;&gt;</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1"><span class="nav-number">4.1.</span> <span class="nav-text"> 建议新起线程不要随便调用网络请求，一般的newThread没有looper队列，参考handlerThread</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4"><span class="nav-number">5.</span> <span class="nav-text">&lt;&lt;网络篇&gt;&gt;</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1"><span class="nav-number">5.1.</span> <span class="nav-text"> Retorfit get 请求参数出现错误的解决方案</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5"><span class="nav-number">6.</span> <span class="nav-text">&lt;&lt;数据篇&gt;&gt;</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1"><span class="nav-number">6.1.</span> <span class="nav-text"> 如何优雅处理 sqlite 多线程读写问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1"><span class="nav-number">6.2.</span> <span class="nav-text"> 如何理解 Intent 传递数据出现 TransactionTooLargeException的问题</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6"><span class="nav-number">7.</span> <span class="nav-text">&lt;&lt;机型系统适配篇&gt;&gt;</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-1"><span class="nav-number">7.1.</span> <span class="nav-text"> 如何解决 NatigationBar 被 PopupWindow 遮挡的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2"><span class="nav-number">7.2.</span> <span class="nav-text"> 如何解决MIUI系统后台无法 toast 的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-3"><span class="nav-number">7.3.</span> <span class="nav-text"> 如何解决关闭通知栏权限无法弹出 toast 的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-4"><span class="nav-number">7.4.</span> <span class="nav-text"> 如何适配 vivo 等双面屏幕</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-5"><span class="nav-number">7.5.</span> <span class="nav-text"> 如何解决华为设备产生太多 broadcast 导致crash的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-6"><span class="nav-number">7.6.</span> <span class="nav-text"> 各种通知栏的适配方案</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-7"><span class="nav-number">7.7.</span> <span class="nav-text"> 解决针对魅族推送内容限制的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-8"><span class="nav-number">7.8.</span> <span class="nav-text"> 解决从系统安装起安装应用后启动，Home 隐藏后 Launcher 重复启动的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-9"><span class="nav-number">7.9.</span> <span class="nav-text"> 针对有launcher做为Activity的应用，在完全没有启动下收到第三方推送（小米，华为，魅族）/分享拉起的注意事项</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-10"><span class="nav-number">7.10.</span> <span class="nav-text"> 针对 App 多场景拉起场景下的场景判断分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-11"><span class="nav-number">7.11.</span> <span class="nav-text"> 9.0 android 支持明文连接（Http）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7"><span class="nav-number">8.</span> <span class="nav-text">&lt;&lt;编译构建篇&gt;&gt;</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#7-1"><span class="nav-number">8.1.</span> <span class="nav-text"> travis-ci 高版本androidO编译遇到 license 没通过编译失败的解决方案</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-2"><span class="nav-number">8.2.</span> <span class="nav-text"> Dalvik 支持的 android 版本下进行分包执行会有一些限制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-3"><span class="nav-number">8.3.</span> <span class="nav-text"> Dalvik 分包构建每一个 dex 文件时可能出现 java.lang.NoClassDefFoundError</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4"><span class="nav-number">8.4.</span> <span class="nav-text"> Java 8 methods of java.lang.Long and java.lang.Character are not desugared by D8 </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-5"><span class="nav-number">8.5.</span> <span class="nav-text"> databinding 中 findBinding vs getBinding 的场景区别 </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-6"><span class="nav-number">8.6.</span> <span class="nav-text"> 版本构建出现 Gradle sync failed: Cannot choose between the following configurations of project </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-7"><span class="nav-number">8.7.</span> <span class="nav-text"> gradle 配置本地离线包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-8"><span class="nav-number">8.8.</span> <span class="nav-text"> 解决kvm/jvm 编译时 -classpath 遇到的分割及空格的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-9"><span class="nav-number">8.9.</span> <span class="nav-text"> databinding NoSuchMethodError with buildTool 3.4.0</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8"><span class="nav-number">9.</span> <span class="nav-text">&lt;&lt;版本控制篇&gt;&gt;</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#8-1"><span class="nav-number">9.1.</span> <span class="nav-text"> git 修改 commit 记录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2"><span class="nav-number">9.2.</span> <span class="nav-text"> 解决git ignore 文件不生效的问题</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9"><span class="nav-number">10.</span> <span class="nav-text">&lt;&lt;其他&gt;&gt;</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#9-1"><span class="nav-number">10.1.</span> <span class="nav-text"> ExoPlayer在接听电话之后会导致原来设置的 Source 中静音状态消失了导致可能返回 app 续播的时候视频突然有声音</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-2"><span class="nav-number">10.2.</span> <span class="nav-text"> AndroidStudio 提示 Please select Android SDK</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-3"><span class="nav-number">10.3.</span> <span class="nav-text"> 关于 Java 中字符与字节的编码关系认识 </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-4"><span class="nav-number">10.4.</span> <span class="nav-text"> 关于 emoji 编码的长度计算问题 </span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2016 &mdash; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yummyLau</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'pPdkM9YTrgYDV8coDCdALdmi-gzGzoHsz',
        appKey: '5HrONz3gb8XPDrUna01sa0gY',
        placeholder: '留下你的足迹呗 ヾﾉ≧∀≦)o',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  

  

  
  

  

  

  

</body>
</html>
